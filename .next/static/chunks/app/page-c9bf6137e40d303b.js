(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1441:function(e,s,t){Promise.resolve().then(t.bind(t,3361))},3361:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return D}});var a=t(7437),n=t(2265),i=t(4573),r=t(4589),l=t(8357),o=t(2560),c=t(4776),d=t(810),m=t(903),u=t(9291);const x={createSession:async(e,s)=>(await fetch("/api/chat-sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e,userId:s})})).json(),getSessions:async e=>(await fetch("/api/chat-sessions?userId=".concat(e))).json(),async deleteSession(e){await fetch("/api/chat-sessions/".concat(e),{method:"DELETE"})},async addMessage(e,s){await fetch("/api/chat-sessions/".concat(e,"/messages"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})},async updateSession(e,s){await fetch("/api/chat-sessions/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:s})})}},h=(0,m.U)()((0,u.tJ)(((e,s)=>({sessions:[],currentSessionId:null,isLoading:!1,currentUser:null,isGuest:!1,createSession:async()=>{const t=s();if(!t.currentUser)throw new Error("User not authenticated");const a="session-".concat(Date.now()),n="\u65b0\u3057\u3044\u30c1\u30e3\u30c3\u30c8",i={id:a,title:n,messages:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};if(e((e=>({sessions:[i,...e.sessions],currentSessionId:a}))),t.isGuest)return a;try{const s=await x.createSession(n,t.currentUser.id);return e((e=>({sessions:e.sessions.map((e=>e.id===a?{...e,id:s.id}:e)),currentSessionId:s.id}))),s.id}catch(r){return a}},selectSession:s=>{e({currentSessionId:s})},deleteSession:async t=>{const a=s();if(e((e=>({sessions:e.sessions.filter((e=>e.id!==t)),currentSessionId:e.currentSessionId===t?null:e.currentSessionId}))),!a.isGuest)try{await x.deleteSession(t)}catch(n){}},addMessage:async(t,a)=>{const n=s(),i=(new Date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),r={...a,timestamp:i};if(e((e=>({sessions:e.sessions.map((e=>{if(e.id===t){const t=[...e.messages||[],r];let n=e.title;return 0===(e.messages||[]).length&&"user"===a.role&&(n=((s=a.content).length>30?s.substring(0,30)+"...":s)||"\u65b0\u3057\u3044\u30c1\u30e3\u30c3\u30c8"),{...e,messages:t,title:n,updatedAt:(new Date).toISOString()}}var s;return e}))}))),!n.isGuest)try{await x.addMessage(t,r)}catch(l){}},updateMessage:(s,t,a)=>{e((e=>({sessions:e.sessions.map((e=>{if(e.id===s){const s=e.messages.map(((e,s)=>s===t?{...e,content:a,timestamp:(new Date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})}:e));return{...e,messages:s,updatedAt:(new Date).toISOString()}}return e}))})))},updateSessionTitle:async(s,t)=>{e((e=>({sessions:e.sessions.map((e=>e.id===s?{...e,title:t,updatedAt:(new Date).toISOString()}:e))})));try{await x.updateSession(s,t)}catch(a){}},getCurrentSession:()=>{const e=s();return e.sessions.find((s=>s.id===e.currentSessionId))||null},clearSessions:()=>{e({sessions:[],currentSessionId:null})},setLoading:s=>{e({isLoading:s})},loadSessions:async()=>{const t=s();if(t.currentUser&&!t.isGuest)try{const s=(await x.getSessions(t.currentUser.id)).map((e=>({...e,messages:e.messages||[]})));e({sessions:s})}catch(a){}},setUser:s=>{e({currentUser:s})},createGuestUser:async()=>{try{const s=Date.now(),t=Math.random().toString(36).substr(2,9),a={id:"guest_".concat(s,"_").concat(t),name:"\u30b2\u30b9\u30c8\u30e6\u30fc\u30b6\u30fc_".concat(s),isGuest:!0,guestToken:"guest_token_".concat(s,"_").concat(t)};return e({currentUser:a,isGuest:!0}),a}catch(s){throw s}},setGuest:s=>{e({isGuest:s})}})),{name:"chat-sessions",partialize:e=>e.isGuest?{sessions:[],currentSessionId:null,currentUser:null,isGuest:!1}:{sessions:e.sessions.map((e=>({...e,messages:(e.messages||[]).map((e=>({...e,imageBase64:void 0,imagePreview:void 0})))}))),currentSessionId:e.currentSessionId,currentUser:e.currentUser,isGuest:e.isGuest}}));function g(e){let{selectedChatId:s,onChatSelect:t}=e;const[i,r]=(0,n.useState)(null),[m,u]=(0,n.useState)(!1),{sessions:x,createSession:g,selectSession:f,deleteSession:p,currentSessionId:b}=h();(0,n.useEffect)((()=>{u(!0)}),[]);const w=m?x:[],y=e=>{const s=new Date(e),t=(new Date).getTime()-s.getTime(),a=Math.floor(t/6e4),n=Math.floor(t/36e5),i=Math.floor(t/864e5);return a<1?"\u305f\u3063\u305f\u4eca":a<60?"".concat(a,"\u5206\u524d"):n<24?"".concat(n,"\u6642\u9593\u524d"):i<7?"".concat(i,"\u65e5\u524d"):s.toLocaleDateString("ja-JP",{month:"short",day:"numeric"})},j=e=>{const s=w.find((s=>s.id===e));if(!s||!s.messages||0===s.messages.length)return"";const t=s.messages[s.messages.length-1];return t.content.length>50?t.content.substring(0,50)+"...":t.content};return(0,a.jsxs)("aside",{className:"w-64 bg-[#161B22] h-full flex flex-col border-r border-gray-700",children:[(0,a.jsx)("div",{className:"flex-shrink-0 p-4 border-b border-gray-700",children:(0,a.jsxs)("button",{onClick:async()=>{const e=await g();f(e),t(e)},className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-[#1E90FF] hover:bg-blue-600 text-white transition-colors font-medium",children:[(0,a.jsx)(l.Z,{className:"h-4 w-4"}),"\u65b0\u898f\u30c1\u30e3\u30c3\u30c8"]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-thin p-2",children:0===w.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:"\u307e\u3060\u30c1\u30e3\u30c3\u30c8\u304c\u3042\u308a\u307e\u305b\u3093"}),(0,a.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"\u65b0\u898f\u30c1\u30e3\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044"})]}):w.map((e=>(0,a.jsx)("div",{onClick:()=>{return s=e.id,f(s),t(s),void r(null);var s},className:"group cursor-pointer rounded-lg p-3 mb-2 transition-colors hover:bg-gray-700 relative ".concat(s===e.id?"bg-gray-700":""),children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(c.Z,{className:"h-5 w-5 text-gray-400 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-100 truncate",children:e.title}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),r(i===e.id?null:e.id)},className:"opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(d.Z,{className:"h-4 w-4 text-gray-400 hover:text-gray-300"})}),i===e.id&&(0,a.jsx)("div",{className:"absolute right-0 top-6 w-32 bg-[#161B22] border border-gray-600 rounded-lg shadow-lg z-10",children:(0,a.jsxs)("button",{onClick:a=>(async(e,a)=>{a.stopPropagation(),await p(e),r(null),s===e&&t(null)})(e.id,a),className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-red-400 hover:bg-gray-700 rounded-lg transition-colors",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4"}),"\u524a\u9664"]})})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-300 mt-1 truncate font-normal",children:j(e.id)}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1 font-medium",children:y(e.updatedAt)})]})]})},e.id)))}),(0,a.jsx)("div",{className:"flex-shrink-0 p-4 border-t border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-700 transition-colors cursor-pointer",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-[#1E90FF] flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white text-sm font-medium",children:"U"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-white",children:"\u30e6\u30fc\u30b6\u30fc"}),(0,a.jsx)("p",{className:"text-xs text-gray-300 font-medium",children:"\u30aa\u30f3\u30e9\u30a4\u30f3"})]})]})})]})}var f=t(842),p=t(7668),b=t(8900),w=t(7135),y=t(9954),j=t(2271),v=t(7904);function N(e){let{chatId:s}=e;const[t,r]=(0,n.useState)(""),[l,o]=(0,n.useState)(!1),[c,d]=(0,n.useState)(null),[m,u]=(0,n.useState)(""),[x,g]=(0,n.useState)(!1),[N,S]=(0,n.useState)(null),[k,F]=(0,n.useState)(!1),[E,C]=(0,n.useState)(null),{getCurrentSession:D,addMessage:I,updateMessage:T,isLoading:P,setLoading:U,setUser:Z,clearSessions:G,isGuest:O}=h(),L=x?D():null;(0,n.useEffect)((()=>{g(!0)}),[]),(0,n.useEffect)((()=>()=>{N&&URL.revokeObjectURL(N.preview)}),[N]);const A=async e=>{if(e.type.startsWith("image/"))try{const s=await(e=>new Promise(((s,t)=>{const a=new FileReader;a.onload=()=>{const e=a.result.split(",")[1];s(e)},a.onerror=t,a.readAsDataURL(e)})))(e),t=await(e=>new Promise(((s,t)=>{const a=new FileReader;a.onload=()=>{const e=a.result;s(e)},a.onerror=t,a.readAsDataURL(e)})))(e);S({file:e,base64:s,preview:t,mimeType:e.type})}catch(s){alert("\u753b\u50cf\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}else alert("\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u306e\u307f\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u53ef\u80fd\u3067\u3059")},_=()=>{S(null)};(0,n.useEffect)((()=>{s&&(null===L||void 0===L||L.id)}),[s,null===L||void 0===L?void 0:L.id]);const B=async()=>{if(!t.trim()||!L||l)return;const e={role:"user",content:t,imageBase64:null===N||void 0===N?void 0:N.base64,imagePreview:null===N||void 0===N?void 0:N.preview},s=t,a=null===N||void 0===N?void 0:N.base64,n=null===N||void 0===N?void 0:N.mimeType;r(""),o(!0),await I(L.id,e),N&&_();try{const e=L.messages.map((e=>({role:e.role,content:e.content}))),t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s,conversationHistory:e,imageBase64:a,imageMimeType:n})}),i=await t.json();if(!t.ok)throw new Error(i.error||"API\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f");const r={role:"assistant",content:i.message};await I(L.id,r)}catch(i){const e={role:"assistant",content:i instanceof Error?i.message:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"};await I(L.id,e)}finally{o(!1)}},M=()=>{d(null),u("")},z=async()=>{if(L&&m.trim()&&null!==c){o(!0);try{T(L.id,c,m.trim());const e=L.messages.slice(0,c+1),s=e[c];e[c]={...s,content:m.trim()};const t=e.map((e=>({role:e.role,content:e.content}))),a=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:m.trim(),conversationHistory:t.slice(0,-1),imageBase64:s.imageBase64,imageMimeType:"image/jpeg"})}),n=await a.json();if(!a.ok)throw new Error(n.error||"API\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f");const i={role:"assistant",content:n.message};await I(L.id,i),d(null),u("")}catch(e){const s={role:"assistant",content:e instanceof Error?e.message:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"};await I(L.id,s)}finally{o(!1)}}};return L?(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"flex-shrink-0 border-b border-gray-700 p-4 flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-lg font-semibold text-white",children:L.title}),O&&(0,a.jsxs)("button",{onClick:()=>{localStorage.removeItem("guestToken"),Z(null),G()},className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors text-sm font-medium",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4"}),"\u30db\u30fc\u30e0\u306b\u623b\u308b"]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-thin px-4 sm:px-6 md:px-4 py-4",children:0===L.messages.length?(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-gray-300 text-sm sm:text-base font-medium",children:"\u307e\u3060\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u3042\u308a\u307e\u305b\u3093\u3002\u6700\u521d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[L.messages.map(((e,s)=>(0,a.jsxs)("div",{className:"flex gap-3 ".concat("user"===e.role?"justify-end":"justify-start"),children:["assistant"===e.role&&(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-[#1E90FF] flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(j.Z,{className:"w-5 h-5 text-white"})}),c===s&&"user"===e.role?(0,a.jsxs)("div",{className:"max-w-[85%] sm:max-w-[75%] md:max-w-[70%] px-4 py-3 rounded-lg bg-gray-700 border-2 border-gray-500",children:[(0,a.jsx)("textarea",{value:m,onChange:e=>u(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),z())},className:"w-full bg-gray-600 text-white rounded-md px-3 py-2 text-sm sm:text-base font-normal leading-relaxed resize-none focus:outline-none focus:ring-2 focus:ring-[#1E90FF]",rows:3,style:{minHeight:"60px"},placeholder:"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u7de8\u96c6\u3057\u3066\u304f\u3060\u3055\u3044..."}),(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsxs)("button",{onClick:M,disabled:l,className:"px-3 py-1 text-sm bg-gray-600 hover:bg-gray-500 text-white rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4 inline mr-1"}),"\u30ad\u30e3\u30f3\u30bb\u30eb"]}),(0,a.jsxs)("button",{onClick:z,disabled:l||!m.trim(),className:"px-3 py-1 text-sm bg-[#1E90FF] hover:bg-blue-600 text-white rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 inline mr-1"}),"\u518d\u9001\u4fe1"]})]})]}):(0,a.jsxs)("div",{className:"max-w-[85%] sm:max-w-[75%] md:max-w-[70%] px-4 py-3 rounded-lg group relative ".concat("user"===e.role?"bg-[#1E90FF] text-white":"bg-[#161B22] text-white border border-gray-700"),children:["user"===e.role&&e.imagePreview&&(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)("img",{src:e.imagePreview,alt:"\u9001\u4fe1\u3057\u305f\u753b\u50cf",className:"max-w-[200px] sm:max-w-[250px] max-h-24 sm:max-h-32 rounded-lg object-contain cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>C(e.imagePreview)})}),(0,a.jsx)("div",{className:"whitespace-pre-wrap break-words text-sm sm:text-base font-normal leading-relaxed",children:e.content}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-70 font-medium",children:[(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("user"===e.role?"bg-blue-900 text-blue-200":"bg-green-900 text-green-200"),children:"user"===e.role?"\u30e6\u30fc\u30b6\u30fc":"AI"}),(0,a.jsx)("span",{children:e.timestamp})]}),"user"===e.role&&!e.imagePreview&&(0,a.jsx)("button",{onClick:()=>{return t=s,a=e.content,d(t),void u(a);var t,a},disabled:l,className:"opacity-0 group-hover:opacity-100 transition-opacity ml-2 p-1 hover:bg-blue-600 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:(0,a.jsx)(b.Z,{className:"w-3 h-3"})})]})]}),"user"===e.role&&(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(v.Z,{className:"w-5 h-5 text-white"})})]},"".concat(L.id,"-").concat(s)))),l&&(0,a.jsxs)("div",{className:"flex gap-3 justify-start",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-[#1E90FF] flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(j.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsx)("div",{className:"max-w-[85%] sm:max-w-[75%] md:max-w-[70%] px-4 py-3 rounded-lg bg-[#161B22] text-white border border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-[#1E90FF] rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-[#1E90FF] rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-[#1E90FF] rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"AI\u304c\u56de\u7b54\u3092\u751f\u6210\u4e2d..."})]})})]})]})}),(0,a.jsx)("div",{className:"flex-shrink-0 border-t border-gray-700 p-4 bg-[#0D1117]",children:(0,a.jsxs)("div",{className:"space-y-3",children:[N&&(0,a.jsxs)("div",{className:"relative inline-block",children:[(0,a.jsx)("img",{src:N.preview,alt:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u753b\u50cf",className:"max-w-full max-h-32 rounded-lg object-contain"}),(0,a.jsx)("button",{onClick:_,className:"absolute top-2 right-2 w-6 h-6 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center text-white transition-colors",children:(0,a.jsx)(i.Z,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"flex gap-3 items-end",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const s=e.target.files;s&&s.length>0&&A(s[0])},className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),(0,a.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-300 transition-colors cursor-pointer",children:(0,a.jsx)(w.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("textarea",{value:t,onChange:e=>r(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),B())},onDragOver:e=>{e.preventDefault(),F(!0)},onDragLeave:e=>{e.preventDefault(),F(!1)},onDrop:e=>{e.preventDefault(),F(!1);const s=e.dataTransfer.files;s.length>0&&A(s[0])},placeholder:"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044...",className:"w-full px-4 py-3 bg-[#161B22] border rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-[#1E90FF] focus:border-transparent resize-none text-sm sm:text-base font-normal transition-colors ".concat(k?"border-[#1E90FF] bg-blue-900/10":"border-gray-600"),rows:1,style:{minHeight:"44px",maxHeight:"120px"}}),k&&(0,a.jsx)("div",{className:"absolute inset-0 border-2 border-[#1E90FF] border-dashed rounded-lg bg-blue-900/20 flex items-center justify-center pointer-events-none",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(y.Z,{className:"w-8 h-8 mx-auto text-[#1E90FF] mb-1"}),(0,a.jsx)("p",{className:"text-sm text-[#1E90FF] font-medium",children:"\u753b\u50cf\u3092\u30c9\u30ed\u30c3\u30d7\u3057\u3066\u304f\u3060\u3055\u3044"})]})})]}),(0,a.jsx)("button",{onClick:B,disabled:!t.trim()||l,className:"p-2 text-[#1E90FF] hover:text-blue-400 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors",children:(0,a.jsx)(p.Z,{className:"w-5 h-5"})})]})]})}),E&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:()=>C(null),children:(0,a.jsxs)("div",{className:"relative max-w-4xl max-h-full",children:[(0,a.jsx)("img",{src:E,alt:"\u62e1\u5927\u753b\u50cf",className:"max-w-full max-h-full object-contain rounded-lg",onClick:e=>e.stopPropagation()}),(0,a.jsx)("button",{onClick:()=>C(null),className:"absolute top-4 right-4 w-8 h-8 bg-black bg-opacity-50 hover:bg-opacity-75 rounded-full flex items-center justify-center text-white transition-all",children:(0,a.jsx)(i.Z,{className:"w-5 h-5"})})]})})]}):(0,a.jsx)("div",{className:"flex flex-col items-center justify-center h-full px-4",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-[#161B22] rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(j.Z,{className:"w-8 h-8 text-[#1E90FF]"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-white mb-2",children:"\u30c1\u30e3\u30c3\u30c8\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),(0,a.jsxs)("p",{className:"text-gray-300 text-sm sm:text-base font-medium",children:[(0,a.jsx)("span",{className:"hidden md:inline",children:"\u5de6\u5074\u306e\u30b5\u30a4\u30c9\u30d0\u30fc\u304b\u3089\u4f1a\u8a71\u3092\u9078\u629e\u3059\u308b\u304b\u3001"}),"\u65b0\u898f\u30c1\u30e3\u30c3\u30c8\u3092\u958b\u59cb\u3057\u3066\u304f\u3060\u3055\u3044\u3002"]})]})})}var S=t(998),k=t(7813),F=t(3925),E=t(7449);function C(e){let{children:s}=e;const{data:t,status:i}=(0,S.useSession)(),[r,l]=(0,n.useState)(!0),{currentUser:o,isGuest:c,setUser:d,createGuestUser:m,setGuest:u,loadSessions:x}=h();(0,n.useEffect)((()=>{(async()=>{if("loading"!==i){if(l(!0),null===t||void 0===t?void 0:t.user){const s={id:t.user.id,name:t.user.name,email:t.user.email,image:t.user.image,isGuest:!1};d(s),u(!1);try{await x()}catch(e){}}l(!1)}})()}),[t,i]);return r||"loading"===i?(0,a.jsx)("div",{className:"flex h-screen bg-[#0D1117] text-white items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-14 w-14 border-b-2 border-[#1E90FF] mx-auto mb-6"}),(0,a.jsx)("p",{className:"text-gray-300 font-semibold text-lg",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})}):(null===t||void 0===t?void 0:t.user)||c&&o?(0,a.jsx)(a.Fragment,{children:s}):(0,a.jsx)("div",{className:"flex h-screen bg-[#0D1117] text-white",children:(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"max-w-lg w-full",children:[(0,a.jsxs)("div",{className:"text-center mb-10",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-[#1E90FF] rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg",children:(0,a.jsx)(k.Z,{className:"w-10 h-10 text-white"})}),(0,a.jsx)("h1",{className:"text-4xl font-black text-white mb-4",children:"chatbot"}),(0,a.jsx)("p",{className:"text-gray-300 text-lg font-medium",children:"\u30ed\u30b0\u30a4\u30f3\u307e\u305f\u306f\u30b2\u30b9\u30c8\u30e2\u30fc\u30c9\u3067\u30c1\u30e3\u30c3\u30c8\u3092\u59cb\u3081\u307e\u3057\u3087\u3046"})]}),(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("button",{onClick:async()=>{try{l(!0);const e=await m();localStorage.setItem("guestToken",e.guestToken),d(e),u(!0),await x(),l(!1)}catch(e){alert("\u30b2\u30b9\u30c8\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(e instanceof Error?e.message:"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc")),l(!1)}},className:"w-full flex items-center justify-center gap-4 px-8 py-5 bg-[#1E90FF] hover:bg-blue-600 text-white rounded-xl transition-all duration-300 font-black text-lg shadow-lg hover:shadow-xl transform hover:scale-[1.02]",children:[(0,a.jsx)(F.Z,{className:"w-6 h-6"}),"\u30b2\u30b9\u30c8\u3068\u3057\u3066\u59cb\u3081\u308b"]}),(0,a.jsxs)("button",{onClick:()=>{(0,S.signIn)("google",{prompt:"select_account"})},className:"w-full flex items-center justify-center gap-4 px-8 py-5 bg-red-600 hover:bg-red-700 text-white rounded-xl transition-all duration-300 font-black text-lg shadow-lg hover:shadow-xl transform hover:scale-[1.02]",children:[(0,a.jsx)(k.Z,{className:"w-6 h-6"}),"Google\u3067\u30ed\u30b0\u30a4\u30f3"]}),(0,a.jsxs)("button",{onClick:()=>{(0,S.signIn)("google")},className:"w-full flex items-center justify-center gap-4 px-8 py-5 bg-green-600 hover:bg-green-700 text-white rounded-xl transition-all duration-300 font-black text-lg shadow-lg hover:shadow-xl transform hover:scale-[1.02]",children:[(0,a.jsx)(E.Z,{className:"w-6 h-6"}),"Google\u3067\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7"]})]}),(0,a.jsx)("div",{className:"mt-10 text-center",children:(0,a.jsxs)("p",{className:"text-gray-400 font-medium",children:["\u30b2\u30b9\u30c8\u30e2\u30fc\u30c9\u3067\u306f\u3001\u30c7\u30fc\u30bf\u306f\u30d6\u30e9\u30a6\u30b6\u306b\u4e00\u6642\u7684\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059",(0,a.jsx)("br",{}),"\u30ed\u30b0\u30a4\u30f3\u30fb\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\u3067\u306f\u3001\u30c1\u30e3\u30c3\u30c8\u5c65\u6b74\u304c\u6c38\u7d9a\u4fdd\u5b58\u3055\u308c\u307e\u3059"]})})]})})})}function D(){const[e,s]=(0,n.useState)(!1),[t,l]=(0,n.useState)(!1),{currentSessionId:o,selectSession:c}=h();(0,n.useEffect)((()=>{s(!0);const e=()=>{l(window.innerWidth>=768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const d=e?o:null;return(0,a.jsx)(C,{children:(0,a.jsxs)("div",{className:"flex h-screen bg-[#0D1117] text-white overflow-hidden",children:[(0,a.jsx)("button",{onClick:()=>{l(!t)},className:"md:hidden fixed top-4 left-4 z-50 p-2 bg-sidebar rounded-lg border border-theme hover:bg-gray-700 transition-colors",style:{backgroundColor:"#161B22",borderColor:"#30363D"},children:t?(0,a.jsx)(i.Z,{className:"w-6 h-6 text-light-theme",style:{color:"#C9D1D9"}}):(0,a.jsx)(r.Z,{className:"w-6 h-6 text-light-theme",style:{color:"#C9D1D9"}})}),t&&(0,a.jsx)("div",{className:"md:hidden fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>{l(!1)}}),(0,a.jsx)("div",{className:"".concat(t?"translate-x-0":"-translate-x-full"," md:translate-x-0 fixed md:static inset-y-0 left-0 z-30 w-64 transition-transform duration-300 ease-in-out"),children:(0,a.jsx)(g,{selectedChatId:d,onChatSelect:e=>{e&&c(e),l(!1)}})}),(0,a.jsx)("main",{className:"flex-1 flex flex-col min-w-0",children:(0,a.jsx)(N,{chatId:d})})]})})}}},function(e){e.O(0,[998,350,971,23,744],(function(){return s=1441,e(e.s=s);var s}));var s=e.O();_N_E=s}]);