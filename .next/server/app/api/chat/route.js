"use strict";(()=>{var e={id:744,ids:[744]};e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6023:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>l,patchFetch:()=>g,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>d,staticGenerationAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{POST:()=>u});var o=s(9303),n=s(8716),a=s(670),i=s(7070);async function u(e){try{if(!process.env.OPENAI_API_KEY)return i.NextResponse.json({error:"DEEPSEEK API\u30ad\u30fc\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093"},{status:500});const{message:t,conversationHistory:s=[],imageBase64:r,imageMimeType:o}=await e.json();if(!t)return i.NextResponse.json({error:"\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5fc5\u8981\u3067\u3059"},{status:400});const n=[{role:"system",content:"\u3042\u306a\u305f\u306f\u89aa\u5207\u3067\u77e5\u8b58\u8c4a\u5bcc\u306aAI\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8\u3067\u3059\u3002\u30e6\u30fc\u30b6\u30fc\u306e\u8cea\u554f\u306b\u4e01\u5be7\u306b\u65e5\u672c\u8a9e\u3067\u56de\u7b54\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},...s,{role:"user",content:r?[{type:"text",text:t},{type:"image_url",image_url:{url:`data:${o||"image/jpeg"};base64,${r}`}}]:t}],a=await fetch("https://api.deepseek.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${process.env.OPENAI_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify({model:"deepseek-chat",messages:n,max_tokens:1e3,temperature:.7,stream:!1})});if(!a.ok){const e=await a.text();throw new Error(`DEEPSEEK API error: ${a.status} - ${e}`)}const u=await a.json(),c=u.choices[0]?.message?.content;return c?i.NextResponse.json({message:c,success:!0}):i.NextResponse.json({error:"AI\u304b\u3089\u306e\u5fdc\u7b54\u3092\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f"},{status:500})}catch(t){if(t instanceof Error){if(t.message.includes("insufficient_quota"))return i.NextResponse.json({error:"API\u5229\u7528\u5236\u9650\u306b\u9054\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u6642\u9593\u3092\u304a\u3044\u3066\u518d\u8a66\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},{status:429});if(t.message.includes("invalid_api_key"))return i.NextResponse.json({error:"API\u30ad\u30fc\u304c\u7121\u52b9\u3067\u3059\u3002\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},{status:401});if(t.message.includes("rate_limit"))return i.NextResponse.json({error:"\u30ec\u30fc\u30c8\u5236\u9650\u306b\u9054\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u5f85\u3063\u3066\u304b\u3089\u518d\u8a66\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},{status:429});if(t.message.includes("timeout")||t.message.includes("network"))return i.NextResponse.json({error:"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u518d\u8a66\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},{status:503})}return i.NextResponse.json({error:"\u30b5\u30fc\u30d0\u30fc\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u8a73\u7d30\u306f\u30ed\u30b0\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},{status:500})}}const c=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"/Users/johnpolison/first-chatbot/app/api/chat/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:d}=c,l="/api/chat/route";function g(){return(0,a.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:m})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=t.X(0,[948,972],(()=>{return e=6023,t(t.s=e);var e}));module.exports=s})();